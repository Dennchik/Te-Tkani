(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var o=0;o<t.length;o++){var l=t[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,s(l.key),l)}}function s(t){var s=function(t,s){if("object"!=e(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var l=o.call(t,s||"default");if("object"!=e(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(t)}(t,"string");return"symbol"==e(s)?s:s+""}var o=function(){return e=function e(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:350;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._target=t,this._duration=s},(s=[{key:"show",value:function(){var e=this._target;if(!e.classList.contains("collapsing")&&!e.classList.contains("_show")){e.classList.remove("_collapse");var t=e.offsetHeight;e.style.height=0,e.style.overflow="hidden",e.style.transition="height ".concat(this._duration,"ms ease"),e.classList.add("collapsing"),e.offsetHeight,e.style.height="".concat(t,"px"),window.setTimeout((function(){e.classList.remove("collapsing"),e.classList.add("_collapse"),e.classList.add("_show"),e.style.height="",e.style.transition="",e.style.overflow=""}),this._duration)}}},{key:"hide",value:function(){var e=this._target;!e.classList.contains("collapsing")&&e.classList.contains("_show")&&(e.style.height="".concat(e.offsetHeight,"px"),e.offsetHeight,e.style.height=0,e.style.overflow="hidden",e.style.transition="height ".concat(this._duration,"ms ease"),e.classList.remove("_collapse"),e.classList.remove("_show"),e.classList.add("collapsing"),window.setTimeout((function(){e.classList.remove("collapsing"),e.classList.add("_collapse"),e.style.height="",e.style.transition="",e.style.overflow=""}),this._duration))}},{key:"toggle",value:function(){this._target.classList.contains("_show")?this.hide():this.show()}}])&&t(e.prototype,s),o&&t(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,s,o}();function l(e,t,s){Array.isArray(e)||(e=[]),t.forEach((function(t){e.includes(t.textContent.trim())?t.classList.add("_selected"):t.classList.remove("_selected")})),n(e,s)}function n(e,t){if(t)if(e&&0!==e.length)if(1===e.length)t.value=e[0];else{var s=e[0],o=e.length-1;t.value="".concat(s," + ещё ").concat(o)}else t.value="Не выбрано"}!function(){var e=function(){try{var e=localStorage.getItem("filters");return e?JSON.parse(e):{}}catch(e){return console.warn("[select] loadFiltersFromLocal: JSON parse error, returning {}",e),{}}}();function t(){document.querySelectorAll(".select._active-collapse").forEach((function(e){var t=e.querySelector("._collapse");if(t){var s=new o(t);try{s.toggle()}catch(e){}}e.classList.remove("_active-collapse")}))}document.addEventListener("click",(function(e){e.target.closest(".select")||t()})),document.addEventListener("keydown",(function(e){"Tab"!==e.key&&"Escape"!==e.key||t()})),document.querySelectorAll("[data-select]").forEach((function(s){Array.from(s.querySelectorAll(".select")).forEach((function(s){var r=Array.from(s.querySelectorAll(".select__list-item")),i=s.querySelector(".select__button"),c=i?i.getAttribute("data-select-key"):null;c||console.warn("[select] data-select-key отсутствует для",s);var a=r.length>0?r[0]:null;function u(e){null!==e&&(a&&a.classList.remove("_selected"),e.focus(),e.classList.add("_selected"),a=e)}c?(Array.isArray(e[c])||(e[c]=[]),l(e[c],r,i)):l([],r,i),s.addEventListener("click",(function(t){var o=t.target;if(o.closest(".select__button")){var l=document.querySelector("._active-collapse");if(f(s),o.closest(".select__box-button")){var r=o.closest(".select__box-button").nextElementSibling;if(r){var u=r.querySelector("._selected");u&&(a=u)}}s.classList.contains("_active-collapse")||i&&i.blur(),l&&l!==s&&f(l)}var y=o.closest(".select__list-item");if(y&&s.contains(y)){var d=y.textContent.trim();c?(Array.isArray(e[c])||(e[c]=[]),e[c].includes(d)?(e[c]=e[c].filter((function(e){return e!==d})),y.classList.remove("_selected"),console.log('[select] Removed value "'.concat(d,'" from key "').concat(c,'"'))):(e[c].push(d),y.classList.add("_selected"),console.log('[select] Added value "'.concat(d,'" to key "').concat(c,'"'))),function(e){try{localStorage.setItem("filters",JSON.stringify(e))}catch(e){console.error("[select] saveFiltersToLocal failed:",e)}}(e),n(e[c],i)):(y.classList.toggle("_selected"),n(Array.from(s.querySelectorAll("._selected")).map((function(e){return e.textContent.trim()})),i))}})),s.addEventListener("keydown",(function(e){if(["ArrowUp","ArrowDown","Enter"].includes(e.key))if(e.preventDefault(),"ArrowUp"===e.key)u(a?a.previousElementSibling:null);else if("ArrowDown"===e.key){u(a?a.nextElementSibling:null)}else"Enter"===e.key&&(!function(){if(!a)return;i&&(i.value=a.textContent.trim(),i.blur())}(),t())}));var f=function(e){var t=e.querySelector("._collapse");if(t){var s=new o(t);e.classList.contains("_active-collapse")?(e.classList.remove("_active-collapse"),s.toggle()):(e.classList.add("_active-collapse"),s.toggle())}}}))}))}()})();